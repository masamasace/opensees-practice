# OpenseesPy関連のメモ

## 2024/07/04

- 目標：OpenseesPyで、単純せん断試験のシミュレーションを行う

### 現状のコード(UCU_test.py)のざっとした説明
- `op.wipe()`はなぜ必要？
    - `op.wipe()`は、OpenseesPyのメモリをクリアする関数
    - これを実行しないと、前回の解析結果が残ってしまう
- `op.model('basic','-ndm',2,'-ndf',3)`はどのような意味を持つ？
    - `op.model('basic')`は、モデルの初期化を行う関数
    - `-ndm`は、次元数を指定するオプション
    - `-ndf`は、自由度の数を指定するオプション
- `op.node(1,0,0)`について
    - `op.node(1,0,0)`は、節点を定義する関数
    - `1`は、節点のID。整数である必要がある。
    - `0,0`は、節点の座標。可変長引数であるため、次元数に応じて座標を指定する。
- `op.fix(1, 1, 1)`について
    - `op.fix(1, 1, 1)`は、節点の拘束条件を設定する関数
    - `1`は、節点のID
    - `1,1`は、拘束条件。`1`は拘束、`0`は拘束なしを意味する。
- `op.nDMaterial('PM4Sand', 1, D_r, G_o, h_po, Den, P_atm, h_o, e_max, e_min, n_b, n_d, A_do, z_max, c_z, c_e, phi_cv, nu, g_degr, c_dr, c_kaf, Q_bolt, R_bolt, m_par, F_sed, p_sed)`について
    - `op.nDMaterial()`は、構成則を設定する関数
        - nDMaterialは、n dimensional materialの略？
    - `PM4Sand`以外にも多くの構成則が使用可能
        - [参考](https://openseespydoc.readthedocs.io/en/latest/src/ndMaterial.html)
    - `1`は、材料のID。整数でないといけない
    - `D_r`は、相対密度
    - `G_o`は、地盤のせん断剛性率
    - `h_po`は、Contraction rate parameter
    - `Den`は、材料の密度
    - (これ以降はoptionalな変数)
        - `P_atm`は、大気圧
        - (以下省略)
- `op.element('quad', 1, 1, 2, 3, 4, 1.0, 'PlaneStrain', 1, 0.0, rho, 0.0, -9.81)`について
    - [参考](https://openseespydoc.readthedocs.io/en/latest/src/quad.html)
    - `op.element()`は、要素を定義する関数
    - `quad`は、要素のタイプ。四角形要素を指定
        - 例えば他には`truss`や`beamColumn`などがある
    - `1`は、要素のID
    - `1,2,3,4`は、要素を構成する節点のID
    - `1.0`は、要素の厚さ
    - `PlaneStrain`は、要素のタイプ。平面ひずみを指定
        - 他には`PlaneStress`がある
    - `1`は、nDMaterialで定義した材料のID
    - これ以降はoptionalな変数
        - `0.0`は、surface pressure
        - `rho`は、要素の質量密度
            - `0.0, -9.81`は、constant body forces defined in the isoparametric domain
- `op.timeSeries('Linear', 1)`について
    - `op.timeSeries()`は、TimeSeriesオブジェクトを作成する関数。このオブジェクトは時刻と荷重ファクターを関連付ける。
    - `Linear`は、TimeSeriesのタイプ。線形に増加する荷重ファクターを指定
        - `1`は、TimeSeriesのID
        - `factor`は、荷重ファクターの増加率
        - `tStart`は、TimeSeriesの開始時刻
        - 計算式は以下のようになる
            - $\lambda = f(t) = factor * (t - tStart)$
    - `Trig`は`Trigonometric`の意味で三角関数の波形を意味する
        - 
        - `op.timeSeries('Trig', tag, tStart, tEnd, period, '-factor', factor=1.0, '-shift', shift=0.0, '-zeroShift', zeroShift=0.0)`
        - `tag`は、TimeSeriesのID
        - `tStart`は、TimeSeriesの開始時刻
        - `tEnd`は、TimeSeriesの終了時刻
        - `period`は、周期
        - `factor`は、荷重ファクターの増加率
        - `shift`は、波形の位相シフト
        - `zeroShift`は、波形の位相シフト。こちらは、$\lambda$の値から決める場合に使う
        - 計算式は以下の通り
            - $\lambda = f(t) = factor * sin(2\pi(t - tStart)/period + \phi)$
                - ここで$ \phi = shift - \frac{period}{2\pi} * arcsin(zeroShift/factor) $

- `op.pattern('Plain', 1, 1)`について
    - `op.pattern()`は、LoadPatternオブジェクトを作成する関数。このオブジェクトは、TimeSeriesオブジェクトとLoadPatternオブジェクトを関連付ける。
        - `Plain`は、LoadPatternのタイプ。簡単な荷重パターンを指定。
        - `1`は、LoadPatternのID
        - `1`は、TimeSeriesのID
        - `can contain multiple NodalLoads, ElementalLoads and SP_Constraint objects`←この記述がよくわからない
- `op.load(1, 0.0, -rho * 9.81 * width * height / 4)`について
    - `op.load()`は、節点に荷重を与える関数
    - `1`は、節点のID
    - `0.0`は、荷重のx成分
    - `-rho * 9.81 * width * height / 4`は、荷重のy成分
        - `rho`は、要素の質量密度
        - `9.81`は、重力加速度
        - `width`は、要素の幅
        - `height`は、要素の高さ
        - `/ 4`は、要素の四つの節点に均等に荷重を与えるため
ここからが重要な気がする...
- `op.system('BandGeneral')`
    - `op.system()`は、解析のシステムを設定する関数
        - [参考](https://openseespydoc.readthedocs.io/en/latest/src/system.html)
    - `BandGeneral`は、バンド行列を用いた解法を指定
- `op.numberer('Plain')`
    - [参考](https://openseespydoc.readthedocs.io/en/latest/src/numberer.html)
    - `op.numberer()`は、節点や自由度の番号付けを行う関数
    - `Plain`は、通常の番号付けを指定
- `op.constraints('Plain')`
    - [参考](https://openseespydoc.readthedocs.io/en/latest/src/PlainConstraint.html)
    - `op.constraints()`は、拘束条件を設定する関数
    - `Plain`は、通常の拘束条件を指定
- `op.integrator('Newmark', 0.5, 0.25)`
    - [参考](https://openseespydoc.readthedocs.io/en/latest/src/integrator.html)
    - `op.integrator()`は、積分法を設定する関数
    - `Newmark`は、ニューマーク法を指定
    - `0.5`は、$\gamma$の値
    - `0.25`は、$\beta$の値
- `op.algorithm('Newton')`
    - [参考](https://openseespydoc.readthedocs.io/en/latest/src/algorithm.html)
    - `op.algorithm()`は、解法アルゴリズムを設定する関数
    - `Newton`は、ニュートン・ラプソン法を指定
- `op.analysis('Transient')`
    - [参考](https://openseespydoc.readthedocs.io/en/latest/src/analysis.html)
    - `op.analysis()`は、解析の種類を設定する関数
    - `Transient`は、静的解析ではない、過渡解析を指定。時間ステップは一定。
- `op.recorder('Element', '-file', 'stress_strain.out', '-time', '-ele', 1, 'stress')`
    - [参考](https://openseespydoc.readthedocs.io/en/latest/src/recorder.html)
    - `op.recorder()`は、結果を記録する関数
    - `Element`は、要素の結果を記録
    - `-file`は、ファイル名を指定
    - `stress_strain.out`は、ファイル名
    - `-time`は、時間を記録
    - `-ele`は、要素を指定
    - `1`は、要素のID
    - `stress`は、記録する結果の種類


### 他のサンプルコードを見てみる
- [PM4Sandを用いたpythonスクリプト](https://github.com/zhuminjie/OpenSeesPyDoc/blob/master/pyExamples/PM4Sand_Cyc_Cal.py)
    - 色々参考になる
    - ざっとした構造は以下の通り。**太字**は、初期コードで考慮していなかった部分
        - Line 28から75まで：モデルのパラメータの設定
            - PM4Sandのオプショナルパラメータまでしっかりと設定されているのが印象的。
        - Line 78から86まで：レイリー減衰のパラメータの設定
        - Line 93：op.model()の設定
            - 次元数は2、自由度は3
        - Line 96から119までは接点と境界条件の設定
            - op.fix()でなぜか3次元目までの拘束条件を設定している
        - **Line 120：op.equalDOF()で節点3と4の変位を等しくする**
        - Line 128でop.nDMaterial()でPM4Sandの設定
        - **Line 131から134で、op.element()の設定**
            - ここで用いているのは`quad`ではなく、`SSPquadUP`という要素
            - `SSPquad`の拡張型
                - `SSPquad`は、四角形要素の中でも特に平面ひずみを考慮したもの
                    - `SSP`はStablized Single Pointの略
                    - 以下ドキュメントからの引用。
                        >  The SSPquad element is a four-node quadrilateral element using physically stabilized single-point integration (SSP –> Stabilized Single Point). The stabilization incorporates an assumed strain field in which the volumetric dilation and the shear strain associated with the the hourglass modes are zero, resulting in an element which is free from volumetric and shear locking. The elimination of shear locking results in greater coarse mesh accuracy in bending dominated problems, and the elimination of volumetric locking improves accuracy in nearly-incompressible problems. Analysis times are generally faster than corresponding full integration elements. The formulation for this element is identical to the solid phase portion of the SSPquadUP element as described by McGann et al. (2012).
                    - 意訳
                        - SSPquad要素は、4つの節点を有する四辺形要素。この要素は物理的に安定である1点積分を用いている。この安定化は、アワーガラスモードに関連するダイレーションとせん断ひずみが0であるひずみ条件下を組み込み、体積およびせん断ロッキングを発生させない。せん断ロッキングをなくすことによって、曲げ支配問題において粗いメッシュの精度が向上し、体積ロッキングをなくすことによって、準非圧縮問題において精度が向上する。解析時間は通常、対応する完全積分要素よりも短い。この要素の公式は、McGannらによって説明されたSSPquadUP要素の固相部分と同一。
            - それでは`SSPquadUP`は？
                - 飽和された多孔質体の動的な平面ひずみ解析に利用される要素
                - u-p formulationを用いている
                - Biotならびに、それを拡張したZienkiewicz and Shiomiの論文に基づく
                - TODO:ドキュメントと関連論文を読む

                        

